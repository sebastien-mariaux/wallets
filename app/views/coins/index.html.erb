<h1>Tokens</h1>

<table class='table table-sm'>
  <thead>
    <tr>
      <th scope='col'>Token</th>
      <th scope='col'>Prix de marché (USD)</th>
      <th scope='col'>Prix de référence (USD)</th>
      <th scope='col'></th>
    </tr>
  </thead>
  <tbody>
    <% @coins.each do |coin| %>
      <tr>
        <td><%= coin.display_name %> </td>
        <td><%= coin.market_value_usd %> </td>
        <td  data-controller="dynamic-field" 
            data-action="click->dynamic-field#displayForm"
            data-dynamic-field-url-value="<%= reference_price_coin_path(coin) %>"
            class='user-input'>
            <div class='reference_price_value' 
                data-dynamic-field-target="display"><%= coin.reference_price %></div>
            <%= form_for coin, url: coin_path(coin),
                          method: :put, remote: true, local: false, 
                          data: {action: "ajax:error->dynamic-field#handleError ajax:success->dynamic-field#handleSuccess"} do |form| %>
            <%= form.hidden_field :reference_price, 
                                  class: "form-control form-control-sm", 
                                  data: { 'action' => "focusout->dynamic-field#updateValue",
                                          'dynamic-field-target' => "input" } %>
            <% end %>
        </td>
        <td>
          <%= link_to 'Transactions', coin_transactions_path(coin) %>
          <%= link_to 'Modifier', edit_coin_path(coin) %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<%= link_to "New coin", new_coin_path %>